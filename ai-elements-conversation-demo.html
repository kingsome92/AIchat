<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½æ•™å­¦åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f7;
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* å·¦ä¾§ä¾§è¾¹æ  */
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px 16px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .menu-list {
            flex: 1;
            padding: 8px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item.active {
            background: #e8e8e8;
            color: #1890ff;
            font-weight: 500;
        }

        .sidebar-footer {
            padding: 12px 16px;
            border-top: 1px solid #f0f0f0;
        }

        .footer-btn {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            color: #666;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            margin-bottom: 8px;
        }

        .footer-btn:last-child {
            margin-bottom: 0;
        }

        .footer-btn:hover {
            background: #f5f5f5;
            border-color: #1890ff;
            color: #1890ff;
        }

        /* å³ä¾§ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .content-header {
            background: white;
            padding: 20px 24px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-header-left {
            flex: 1;
        }

        .content-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .content-header p {
            font-size: 13px;
            color: #999;
        }

        .content-header-actions {
            display: flex;
            gap: 8px;
        }

        .header-action-btn {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            color: #666;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-action-btn:hover {
            background: #f5f5f5;
            border-color: #1890ff;
            color: #1890ff;
        }

        .header-action-btn.primary {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .header-action-btn.primary:hover {
            background: #40a9ff;
        }

        .content-body {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* èŠå¤©ç•Œé¢æ ·å¼ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #fafafa;
        }

        .chat-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        ai-message {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 75%;
            margin-bottom: 16px;
        }

        .message > div:last-child {
            flex: 1;
            min-width: 0;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.assistant {
            align-self: flex-start;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
            font-size: 14px;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #00d4ff 0%, #5b8def 100%);
            color: white;
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            line-height: 1.6;
            word-wrap: break-word;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        .message.user .message-time {
            text-align: left;
        }

        .message.assistant .message-time {
            text-align: left;
        }

        /* ä»»åŠ¡æ¸…å•æ ·å¼ */
        .task-list {
            margin-top: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #1890ff;
        }

        .task-list-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 13px;
            color: #666;
        }

        .task-item:last-child {
            margin-bottom: 0;
        }

        .task-checkbox {
            margin-top: 2px;
            flex-shrink: 0;
        }

        /* å·¥å…·è°ƒç”¨ç›‘æ§åˆ—è¡¨ */
        .tool-monitor {
            margin-top: 12px;
            padding: 12px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 1px solid #d4e9ff;
        }

        .tool-monitor-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .tool-item {
            padding: 6px 8px;
            background: white;
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 12px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tool-item:last-child {
            margin-bottom: 0;
        }

        .tool-status {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .tool-status.success {
            background: #f6ffed;
            color: #52c41a;
        }

        .tool-status.processing {
            background: #fff7e6;
            color: #faad14;
        }

        /* è¾“å…¥åŒºåŸŸ */
        ai-prompt-input {
            display: block;
            border-top: 1px solid #e0e0e0;
            background: white;
            flex-shrink: 0;
        }

        .prompt-input-container {
            padding: 16px 24px;
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .prompt-input-wrapper {
            flex: 1;
            position: relative;
        }

        .prompt-input {
            width: 100%;
            min-height: 44px;
            max-height: 120px;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            outline: none;
            transition: border-color 0.3s;
            background: #fafafa;
        }

        .prompt-input:focus {
            border-color: #1890ff;
            background: white;
        }

        .prompt-input::placeholder {
            color: #999;
        }

        .input-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .voice-button {
            width: 44px;
            height: 44px;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            background: white;
            color: #666;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            font-size: 10px;
            gap: 2px;
        }

        .voice-button:hover {
            background: #f5f5f5;
            border-color: #1890ff;
            color: #1890ff;
        }

        .voice-button svg {
            width: 18px;
            height: 18px;
        }

        .send-button {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-button svg {
            width: 20px;
            height: 20px;
        }

        .file-upload-btn {
            width: 44px;
            height: 44px;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            background: white;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .file-upload-btn:hover {
            background: #f5f5f5;
            border-color: #1890ff;
            color: #1890ff;
        }

        .file-upload-btn svg {
            width: 20px;
            height: 20px;
        }

        .file-input {
            display: none;
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            max-width: 100px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #1890ff;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* é…ç½®é¢æ¿æ ·å¼ - Ant Designé£æ ¼ */
        .config-panel {
            display: none;
            flex-direction: column;
            height: 100%;
            background: #f5f5f5;
            padding: 24px;
            overflow-y: auto;
        }

        .config-panel.active {
            display: flex;
        }

        .config-status {
            background: #fff;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.02);
        }

        .config-status-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .config-status-label {
            font-weight: 600;
            color: #262626;
            font-size: 16px;
        }

        .config-status-left > span:last-child {
            color: #595959;
            font-size: 14px;
        }

        .config-status-right {
            color: #8c8c8c;
            font-size: 13px;
        }

        .config-form {
            background: #fff;
            border-radius: 6px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #262626;
            line-height: 1.5715;
        }

        .form-label::before {
            display: inline-block;
            margin-right: 4px;
            color: #ff4d4f;
            font-size: 14px;
            font-family: SimSun, sans-serif;
            line-height: 1;
            content: '*';
        }

        .form-label.optional::before {
            content: '';
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 6.5px 11px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.5715;
            color: rgba(0, 0, 0, 0.88);
            transition: all 0.2s;
            outline: none;
            background-color: #fff;
        }

        .form-input:focus,
        .form-select:focus {
            border-color: #4096ff;
            box-shadow: 0 0 0 2px rgba(5, 145, 255, 0.1);
        }

        .form-input:disabled,
        .form-select:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            color: rgba(0, 0, 0, 0.25);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
            padding: 6.5px 11px;
        }

        .form-row {
            display: flex;
            gap: 16px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .checkbox-group {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #1890ff;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.88);
            margin: 0;
        }

        .radio-group {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-item input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #1890ff;
        }

        .radio-item label {
            cursor: pointer;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.88);
            margin: 0;
        }

        .tag-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 4px 12px;
            background: #f0f0f0;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 13px;
            color: rgba(0, 0, 0, 0.88);
            line-height: 20px;
            cursor: default;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #f0f0f0;
        }

        .btn {
            padding: 6.4px 15px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.5715;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
            color: rgba(0, 0, 0, 0.88);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.02);
        }

        .btn:hover {
            color: #4096ff;
            border-color: #4096ff;
        }

        .btn:active {
            color: #0958d9;
            border-color: #0958d9;
        }

        .btn-primary {
            background: #1890ff;
            color: #fff;
            border-color: #1890ff;
            box-shadow: 0 2px 0 rgba(5, 145, 255, 0.1);
        }

        .btn-primary:hover {
            background: #40a9ff;
            border-color: #40a9ff;
        }

        .btn-primary:active {
            background: #0958d9;
            border-color: #0958d9;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .chat-content::-webkit-scrollbar,
        .config-panel::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .chat-content::-webkit-scrollbar-track,
        .config-panel::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-content::-webkit-scrollbar-thumb,
        .config-panel::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        .chat-content::-webkit-scrollbar-thumb:hover,
        .config-panel::-webkit-scrollbar-thumb:hover,
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        /* ä¸Šä¼ å›¾ç‰‡é¢„è§ˆ */
        .image-preview {
            margin-top: 8px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .image-preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-item .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
                font-size: 12px;
        }

        /* ä½œä¸šé¢„è§ˆæ¨¡æ€æ¡†æ ·å¼ */
        .homework-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.45);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .homework-preview-modal.active {
            display: flex;
        }

        .homework-preview-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .homework-preview-header {
            padding: 16px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .homework-preview-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.88);
        }

        .homework-preview-close {
            width: 22px;
            height: 22px;
            border: none;
            background: transparent;
            font-size: 18px;
            color: rgba(0, 0, 0, 0.45);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .homework-preview-close:hover {
            background: #f5f5f5;
            color: rgba(0, 0, 0, 0.88);
        }

        .homework-preview-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .preview-item {
            margin-bottom: 20px;
        }

        .preview-item:last-child {
            margin-bottom: 0;
        }

        .preview-label {
            font-weight: 600;
            color: rgba(0, 0, 0, 0.88);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .preview-value {
            color: rgba(0, 0, 0, 0.65);
            font-size: 14px;
            line-height: 1.5715;
        }

        .preview-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .preview-tag {
            padding: 4px 12px;
            background: #f0f0f0;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 13px;
            color: rgba(0, 0, 0, 0.88);
        }

        .homework-view-btn:hover {
            background: #40a9ff !important;
            box-shadow: 0 2px 4px rgba(5, 145, 255, 0.2);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }

            .message {
                max-width: 85%;
            }

            .homework-preview-content {
                width: 95%;
                max-height: 95vh;
            }
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div style="font-weight: 600; color: #333; margin-bottom: 4px;">AIæ™ºèƒ½æ•™å­¦åŠ©æ‰‹</div>
            <div style="font-size: 12px;">é€‰æ‹©åŠŸèƒ½æ¨¡å—</div>
        </div>
        <div class="menu-list">
            <div class="menu-item" data-function="history">
                <span>ğŸ“‹</span>
                <span>ä¼šè¯è®°å½•</span>
            </div>
            <div class="menu-item" data-function="prep">
                <span>ğŸ“š</span>
                <span>ä¸€é”®å¤‡è¯¾</span>
            </div>
            <div class="menu-item active" data-function="homework">
                <span>ğŸ“</span>
                <span>ä½œä¸šå¸ƒç½®</span>
            </div>
            <div class="menu-item" data-function="analysis">
                <span>ğŸ“Š</span>
                <span>å­¦æƒ…åˆ†æ</span>
            </div>
            <div class="menu-item" data-function="grading">
                <span>âœï¸</span>
                <span>ä½œæ–‡æ‰¹æ”¹</span>
            </div>
            <div class="menu-item" data-function="export">
                <span>ğŸ“¤</span>
                <span>æˆç»©å¯¼å‡º</span>
            </div>
            <div class="menu-item" data-function="video">
                <span>ğŸ¥</span>
                <span>AIè§†é¢‘è®²é¢˜</span>
            </div>
            <div class="menu-item" data-function="ppt">
                <span>ğŸ“„</span>
                <span>è¯¾ä»¶PPT</span>
            </div>
            <div class="menu-item" data-function="graphics">
                <span>ğŸ“</span>
                <span>æ•°å­¦å›¾å½¢è®¾è®¡</span>
            </div>
            <div class="menu-item" data-function="grouping">
                <span>ğŸ‘¥</span>
                <span>æ™ºèƒ½åˆ†ç»„</span>
            </div>
            <div class="menu-item" data-function="plan">
                <span>ğŸ“…</span>
                <span>æ•™å­¦è®¡åˆ’</span>
            </div>
        </div>
        <div class="sidebar-footer">
            <button class="footer-btn" id="myBtn">æˆ‘çš„</button>
        </div>
        </div>

    <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <div class="content-header">
            <div class="content-header-left">
                <h2 id="functionTitle">ä½œä¸šå¸ƒç½®</h2>
                <p id="functionSubtitle">AIè‡ªåŠ¨å¸ƒç½®ä½œä¸š,è¯·æè¿°æ‚¨çš„è¦æ±‚å§</p>
            </div>
            <div class="content-header-actions" id="headerActions">
                <button class="header-action-btn" id="historyBtn" title="å†å²è®°å½•">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>å†å²è®°å½•</span>
                </button>
                <button class="header-action-btn primary" id="newChatBtn" title="æ–°å»ºä¼šè¯">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>ä¼šè¯</span>
                </button>
            </div>
        </div>
        <div class="content-body">
            <!-- èŠå¤©ç•Œé¢ -->
            <div class="chat-container" id="chatContainer">
                <div class="chat-content" id="chatContent">
                </div>

            <ai-prompt-input>
                <div class="prompt-input-container">
                        <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
                        <button class="file-upload-btn" id="fileUploadBtn" type="button" title="ä¸Šä¼ å›¾ç‰‡">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </button>
                    <div class="prompt-input-wrapper">
                        <textarea 
                            id="promptInput" 
                            class="prompt-input" 
                                placeholder="è¯·è¾“å…¥æ‚¨çš„è¦æ±‚æˆ–è€…è¯­éŸ³æè¿°" 
                            rows="1"
                        ></textarea>
                            <div class="image-preview" id="imagePreview"></div>
                    </div>
                        <div class="input-actions">
                            <button class="voice-button" id="voiceBtn" type="button" title="è¯­éŸ³è¾“å…¥">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                                <span>è¯­éŸ³</span>
                    </button>
                            <button class="send-button" id="sendButton" type="button">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                        </div>
                </div>
            </ai-prompt-input>
            </div>

            <!-- é…ç½®é¢æ¿ -->
            <div class="config-panel" id="configPanel">
                <div class="config-status">
                    <div class="config-status-left">
                        <span class="config-status-label">ä½œä¸š</span>
                        <span>å·²ä¸ºæ‚¨åˆ›å»ºå¦‚ä¸‹é…ç½®ä½œä¸š,è¯·ç¡®è®¤åæ‰§è¡Œ</span>
                    </div>
                    <div class="config-status-right" id="configTime">2åˆ†é’Ÿå‰</div>
                </div>

                <div class="config-form">
                    <div class="form-group">
                        <label class="form-label">å­¦æ®µå­¦ç§‘</label>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" class="form-input" value="æ•°å­¦" readonly>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" class="form-input" placeholder="è¯·é€‰æ‹©" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç‰ˆæœ¬åˆ†å†Œ</label>
                        <input type="text" class="form-input" value="äººæ•™ç‰ˆä¸ƒå¹´çº§ä¸Šå†Œ" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label optional">æ•™è¾…ç›®å½•</label>
                        <select class="form-select" id="textbookCatalog">
                            <option value="">è¯·é€‰æ‹©æ•™è¾…ç›®å½•</option>
                            <option value="ç¬¬ä¸€ç«  æœ‰ç†æ•°">ç¬¬ä¸€ç«  æœ‰ç†æ•°</option>
                            <option value="ç¬¬äºŒç«  æ•´å¼çš„åŠ å‡">ç¬¬äºŒç«  æ•´å¼çš„åŠ å‡</option>
                            <option value="ç¬¬ä¸‰ç«  ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹">ç¬¬ä¸‰ç«  ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹</option>
                            <option value="ç¬¬å››ç«  å‡ ä½•å›¾å½¢åˆæ­¥">ç¬¬å››ç«  å‡ ä½•å›¾å½¢åˆæ­¥</option>
                            <option value="ç¬¬äº”ç«  ç›¸äº¤çº¿ä¸å¹³è¡Œçº¿">ç¬¬äº”ç«  ç›¸äº¤çº¿ä¸å¹³è¡Œçº¿</option>
                            <option value="ç¬¬å…­ç«  å®æ•°">ç¬¬å…­ç«  å®æ•°</option>
                            <option value="ç¬¬ä¸ƒç«  å¹³é¢ç›´è§’åæ ‡ç³»">ç¬¬ä¸ƒç«  å¹³é¢ç›´è§’åæ ‡ç³»</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">çŸ¥è¯†ç‚¹</label>
                        <textarea class="form-input form-textarea" readonly>ä¸‰è§’å½¢ä½™å¼¦å®šç†</textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">é¢˜å‹</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="type1" checked>
                                <label for="type1">å•é€‰</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="type2" checked>
                                <label for="type2">å¤šé€‰</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="type3" checked>
                                <label for="type3">å¡«ç©º</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="type4" checked>
                                <label for="type4">åˆ¤æ–­</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="type5" checked>
                                <label for="type5">è§£ç­”</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="type6" checked>
                                <label for="type6">ä½œå›¾</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ•°é‡</label>
                        <input type="text" class="form-input" value="10" readonly>
                        <span style="font-size: 13px; color: #999; margin-left: 8px;">é“(å«å°é¢˜)</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ä½œä¸šç±»å‹</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="homeworkType" id="typeTimed" checked>
                                <label for="typeTimed">é™æ—¶ä½œä¸š</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="homeworkType" id="typeClass">
                                <label for="typeClass">éšå ‚ä½œä¸š</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="homeworkType" id="typeExam">
                                <label for="typeExam">è€ƒè¯•æµ‹éªŒ</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="homeworkType" id="typeNormal">
                                <label for="typeNormal">æ™®é€šä½œä¸š</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å‘å¸ƒå¯¹è±¡</label>
                        <div class="tag-group">
                            <span class="tag">2024çº§1ç­Aç»„</span>
                            <span class="tag">2024çº§1ç­Bç»„</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å‘å¸ƒæ—¶é—´</label>
                        <input type="text" class="form-input" value="2025-12-08 20:00" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å…¶ä»–è¦æ±‚</label>
                        <textarea class="form-input form-textarea" placeholder="å¡«å…¥è¡¥å……ä¿¡æ¯"></textarea>
                    </div>

                    <div class="form-actions">
                        <button class="btn" id="cancelBtn">å–æ¶ˆ</button>
                        <button class="btn" id="previewBtn">é¢„è§ˆ</button>
                        <button class="btn btn-primary" id="publishBtn">å‘å¸ƒ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®šä¹‰ AI Conversation Web Component
        class AIConversation extends HTMLElement {
            constructor() {
                super();
            }
            connectedCallback() {
                this.setAttribute('role', 'conversation');
            }
        }
        customElements.define('ai-conversation', AIConversation);

        // å®šä¹‰ AI Message Web Component
        class AIMessage extends HTMLElement {
            constructor() {
                super();
            }
            static get observedAttributes() {
                return ['role'];
            }
            connectedCallback() {
                this.setAttribute('role', this.getAttribute('role') || 'assistant');
            }
        }
        customElements.define('ai-message', AIMessage);

        // å®šä¹‰ AI Prompt Input Web Component
        class AIPromptInput extends HTMLElement {
            constructor() {
                super();
            }
            connectedCallback() {
                this.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const input = this.querySelector('textarea');
                    if (input && input.value.trim()) {
                        this.dispatchEvent(new CustomEvent('message-send', {
                            detail: { message: input.value.trim() },
                            bubbles: true
                        }));
                    }
                });
            }
        }
        customElements.define('ai-prompt-input', AIPromptInput);

        // åº”ç”¨çŠ¶æ€
        const appState = {
            currentFunction: 'homework',
            messages: [],
            uploadedImages: [],
            isProcessing: false
        };

        // DOM å…ƒç´ 
        const chatContent = document.getElementById('chatContent');
        const chatContainer = document.getElementById('chatContainer');
        const configPanel = document.getElementById('configPanel');
        const promptInput = document.getElementById('promptInput');
        const sendButton = document.getElementById('sendButton');
        const fileInput = document.getElementById('fileInput');
        const fileUploadBtn = document.getElementById('fileUploadBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const imagePreview = document.getElementById('imagePreview');
        const menuItems = document.querySelectorAll('.menu-item');
        const functionTitle = document.getElementById('functionTitle');
        const functionSubtitle = document.getElementById('functionSubtitle');
        const myBtn = document.getElementById('myBtn');
        const newChatBtn = document.getElementById('newChatBtn');
        const historyBtn = document.getElementById('historyBtn');
        const previewBtn = document.getElementById('previewBtn');
        const publishBtn = document.getElementById('publishBtn');
        const cancelBtn = document.getElementById('cancelBtn');

        // åŠŸèƒ½é…ç½®
        const functionConfig = {
            history: { 
                title: 'ä¼šè¯è®°å½•', 
                subtitle: 'æŸ¥çœ‹å†å²ä¼šè¯è®°å½•',
                welcomeMessage: 'æ‚¨å¥½ï¼è¿™é‡Œæ˜¯ä¼šè¯è®°å½•åŠŸèƒ½ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å†å²ä¼šè¯è®°å½•ã€‚'
            },
            prep: { 
                title: 'ä¸€é”®å¤‡è¯¾', 
                subtitle: 'AIæ™ºèƒ½å¤‡è¯¾åŠ©æ‰‹',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯ä¸€é”®å¤‡è¯¾åŠ©æ‰‹ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦å‡†å¤‡ä»€ä¹ˆè¯¾ç¨‹ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨å¿«é€Ÿç”Ÿæˆå¤‡è¯¾æ–¹æ¡ˆã€‚'
            },
            homework: { 
                title: 'ä½œä¸šå¸ƒç½®', 
                subtitle: 'AIè‡ªåŠ¨å¸ƒç½®ä½œä¸š,è¯·æè¿°æ‚¨çš„è¦æ±‚å§',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯ä½œä¸šå¸ƒç½®åŠ©æ‰‹ã€‚è¯·é€šè¿‡è¯­éŸ³æˆ–æ–‡å­—æè¿°æ‚¨çš„ä½œä¸šéœ€æ±‚ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¤„ç†æ‚¨ä¸Šä¼ çš„å›¾ç‰‡ã€‚è®©æˆ‘æ¥å¸®æ‚¨å¸ƒç½®ä½œä¸šï¼'
            },
            analysis: { 
                title: 'å­¦æƒ…åˆ†æ', 
                subtitle: 'æ™ºèƒ½åˆ†æå­¦ç”Ÿå­¦ä¹ æƒ…å†µ',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯å­¦æƒ…åˆ†æåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®æ‚¨åˆ†æå­¦ç”Ÿçš„å­¦ä¹ æƒ…å†µï¼Œç”Ÿæˆè¯¦ç»†çš„åˆ†ææŠ¥å‘Šã€‚'
            },
            grading: { 
                title: 'ä½œæ–‡æ‰¹æ”¹', 
                subtitle: 'AIæ™ºèƒ½æ‰¹æ”¹ä½œæ–‡',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯ä½œæ–‡æ‰¹æ”¹åŠ©æ‰‹ã€‚è¯·ä¸Šä¼ å­¦ç”Ÿçš„ä½œæ–‡ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨è¿›è¡Œæ™ºèƒ½æ‰¹æ”¹å’Œè¯„åˆ†ã€‚'
            },
            export: { 
                title: 'æˆç»©å¯¼å‡º', 
                subtitle: 'å¯¼å‡ºå­¦ç”Ÿæˆç»©æ•°æ®',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æˆç»©å¯¼å‡ºåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®æ‚¨å¯¼å‡ºå­¦ç”Ÿçš„æˆç»©æ•°æ®ï¼Œæ”¯æŒå¤šç§æ ¼å¼ã€‚'
            },
            video: { 
                title: 'AIè§†é¢‘è®²é¢˜', 
                subtitle: 'ç”Ÿæˆè§†é¢‘è®²è§£é¢˜ç›®',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯AIè§†é¢‘è®²é¢˜åŠ©æ‰‹ã€‚è¯·æä¾›é¢˜ç›®ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨ç”Ÿæˆè§†é¢‘è®²è§£ã€‚'
            },
            ppt: { 
                title: 'è¯¾ä»¶PPT', 
                subtitle: 'æ™ºèƒ½ç”Ÿæˆè¯¾ä»¶PPT',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯è¯¾ä»¶PPTåŠ©æ‰‹ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨çš„è¯¾ç¨‹ä¸»é¢˜å’Œå†…å®¹ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨ç”Ÿæˆç²¾ç¾çš„PPTè¯¾ä»¶ã€‚'
            },
            graphics: { 
                title: 'æ•°å­¦å›¾å½¢è®¾è®¡', 
                subtitle: 'è®¾è®¡æ•°å­¦å›¾å½¢',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ•°å­¦å›¾å½¢è®¾è®¡åŠ©æ‰‹ã€‚è¯·æè¿°æ‚¨éœ€è¦çš„æ•°å­¦å›¾å½¢ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨è®¾è®¡å’Œç»˜åˆ¶ã€‚'
            },
            grouping: { 
                title: 'æ™ºèƒ½åˆ†ç»„', 
                subtitle: 'æ™ºèƒ½åˆ†ç»„å­¦ç”Ÿ',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½åˆ†ç»„åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥æ ¹æ®å­¦ç”Ÿçš„ç‰¹ç‚¹å’Œå­¦ä¹ æƒ…å†µï¼Œå¸®æ‚¨è¿›è¡Œæ™ºèƒ½åˆ†ç»„ã€‚'
            },
            plan: { 
                title: 'æ•™å­¦è®¡åˆ’', 
                subtitle: 'åˆ¶å®šæ•™å­¦è®¡åˆ’',
                welcomeMessage: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ•™å­¦è®¡åˆ’åŠ©æ‰‹ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨çš„æ•™å­¦ç›®æ ‡å’Œè¯¾ç¨‹å®‰æ’ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨åˆ¶å®šè¯¦ç»†çš„æ•™å­¦è®¡åˆ’ã€‚'
            }
        };

        // åˆ‡æ¢åŠŸèƒ½
        function switchFunction(functionName, keepMessages = false) {
            appState.currentFunction = functionName;
            
            // æ›´æ–°èœå•æ¿€æ´»çŠ¶æ€
            menuItems.forEach(item => {
                if (item.dataset.function === functionName) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            // æ›´æ–°æ ‡é¢˜
            const config = functionConfig[functionName] || functionConfig.homework;
            functionTitle.textContent = config.title;
            functionSubtitle.textContent = config.subtitle;

            // é‡ç½®é…ç½®é¢æ¿çŠ¶æ€
            appState.showConfig = false;

            // æ ¹æ®åŠŸèƒ½æ˜¾ç¤ºä¸åŒç•Œé¢
            if (functionName === 'homework' && appState.showConfig) {
                // æ˜¾ç¤ºé…ç½®é¢æ¿
                chatContainer.style.display = 'none';
                configPanel.classList.add('active');
            } else {
                // æ˜¾ç¤ºèŠå¤©ç•Œé¢
                chatContainer.style.display = 'flex';
                configPanel.classList.remove('active');
                
                // å¦‚æœä¸æ˜¯ä¿æŒæ¶ˆæ¯ï¼Œåˆ™æ¸…ç©ºå¹¶æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                if (!keepMessages) {
                    chatContent.innerHTML = '';
                    appState.messages = [];
                    appState.uploadedImages = [];
                    imagePreview.innerHTML = '';
                    
                    // æ·»åŠ æ¬¢è¿æ¶ˆæ¯
                    const welcomeMsg = config.welcomeMessage || 'æ‚¨å¥½ï¼æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ã€‚';
                    addMessage('assistant', welcomeMsg);
                }
            }
        }

        // èœå•é¡¹ç‚¹å‡»äº‹ä»¶
        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                switchFunction(item.dataset.function);
            });
        });

        // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬åŸŸé«˜åº¦
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        promptInput.addEventListener('input', () => {
            autoResizeTextarea(promptInput);
        });

        // è·å–ç›¸å¯¹æ—¶é—´
        function getRelativeTime() {
            return 'åˆšåˆš';
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°å¯¹è¯
        function addMessage(role, content, images = []) {
            const messageDiv = document.createElement('ai-message');
            messageDiv.setAttribute('role', role);
            
            const time = getRelativeTime();
            let imageHTML = '';
            if (images && images.length > 0) {
                imageHTML = '<div style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">';
                images.forEach(img => {
                    imageHTML += `<img src="${img}" style="max-width: 200px; max-height: 200px; border-radius: 6px; border: 1px solid #e0e0e0;" />`;
                });
                imageHTML += '</div>';
            }
            
            const messageHTML = `
                <div class="message ${role}">
                    <div class="message-avatar">${role === 'user' ? 'æˆ‘' : 'AI'}</div>
                    <div>
                        <div class="message-content">${content.replace(/\n/g, '<br>')}${imageHTML}</div>
                        <div class="message-time">${time}</div>
                    </div>
                </div>
            `;
            
            messageDiv.innerHTML = messageHTML;
            chatContent.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                chatContent.scrollTop = chatContent.scrollHeight;
            }, 100);
        }

        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'message assistant';
            typingDiv.innerHTML = `
                <div class="message-avatar">AI</div>
                <div>
                    <div class="typing-indicator">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            chatContent.appendChild(typingDiv);
            chatContent.scrollTop = chatContent.scrollHeight;
        }

        // éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // å¤„ç†ä½œä¸šå¸ƒç½®è¯·æ±‚
        async function handleHomeworkRequest(userMessage, images) {
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä½œä¸šå¸ƒç½®è¯·æ±‚
            const homeworkKeywords = ['ä½œä¸š', 'å¸ƒç½®', 'å‘å¸ƒ', 'é¢˜ç›®', 'é¢˜ç›®', 'ç­çº§', 'ç»„'];
            const isHomeworkRequest = homeworkKeywords.some(keyword => userMessage.includes(keyword));

            if (isHomeworkRequest && appState.currentFunction === 'homework') {
                // æ˜¾ç¤ºä»»åŠ¡è§„åˆ’
                await new Promise(resolve => setTimeout(resolve, 500));
                hideTypingIndicator();
                
                const taskListHTML = `
                    <div class="message assistant">
                        <div class="message-avatar">AI</div>
                        <div>
                            <div class="message-content">
                                æ­£åœ¨å¸®æ‚¨è§„åˆ’ä»»åŠ¡....
                                <div class="task-list">
                                    <div class="task-list-title">ä»»åŠ¡æ¸…å•:</div>
                                    <div class="task-item">
                                        <input type="checkbox" class="task-checkbox" disabled>
                                        <span>è·å–"æˆ‘"çš„ä»»è¯¾ä¿¡æ¯ä¸ä½¿ç”¨æ•™æç‰ˆæœ¬,ç¡®è®¤é¢˜åº“ä¸ç« èŠ‚è¯¾æ—¶</span>
                                    </div>
                                    <div class="task-item">
                                        <input type="checkbox" class="task-checkbox" disabled>
                                        <span>è·å–ç­çº§ä¸åˆ†ç»„ä¿¡æ¯</span>
                                    </div>
                                    <div class="task-item">
                                        <input type="checkbox" class="task-checkbox" disabled>
                                        <span>ç”Ÿæˆä½œä¸šé…ç½®:ä½œä¸šåç§°ã€å‘å¸ƒå¯¹è±¡ã€å®šæ—¶ã€é™æ—¶ç­‰é…ç½®</span>
                                    </div>
                                </div>
                                <div class="tool-monitor">
                                    <div class="tool-monitor-title">æ­¤å¤„æ˜¯å·¥å…·è°ƒç”¨ingç›‘æ§æ»šåŠ¨åˆ—è¡¨</div>
                                    <div class="tool-item">
                                        <span>user="æ•™å¸ˆå§“å"&class="2024çº§1ç­"&group="A&B"</span>
                                        <span class="tool-status success">æ‰§è¡ŒæˆåŠŸ</span>
                                    </div>
                                    <div class="tool-item">
                                        <span>user="æ•™å¸ˆå§“å"&class="2024çº§1ç­"&group="A&B"</span>
                                        <span class="tool-status success">æ‰§è¡ŒæˆåŠŸ</span>
                                    </div>
                                    <div class="tool-item">
                                        <span>user="æ•™å¸ˆå§“å"&class="2024çº§1ç­"&group="A&B"</span>
                                        <span class="tool-status processing">è¿›è¡Œä¸­</span>
                                    </div>
                                </div>
                            </div>
                            <div class="message-time">åˆšåˆš</div>
                        </div>
                    </div>
                `;
                
                const messageDiv = document.createElement('ai-message');
                messageDiv.setAttribute('role', 'assistant');
                messageDiv.innerHTML = taskListHTML;
                chatContent.appendChild(messageDiv);
                
                // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œåˆ‡æ¢åˆ°é…ç½®é¢æ¿
                setTimeout(() => {
                    // æ›´æ–°ä»»åŠ¡çŠ¶æ€
                    const checkboxes = messageDiv.querySelectorAll('.task-checkbox');
                    checkboxes.forEach(cb => cb.checked = true);
                    
                    // åˆ‡æ¢åˆ°é…ç½®é¢æ¿
                    setTimeout(() => {
                        chatContainer.style.display = 'none';
                        configPanel.classList.add('active');
                        appState.showConfig = true;
                    }, 1000);
                }, 2000);
                
                return;
            }

            // æ™®é€šå›å¤
            hideTypingIndicator();
                    const responses = [
                `æˆ‘ç†è§£æ‚¨è¯´çš„æ˜¯ï¼š"${userMessage}"ã€‚è®©æˆ‘æ¥å¸®æ‚¨å¤„ç†ã€‚`,
                `å…³äº"${userMessage}"ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚`,
                `æ„Ÿè°¢æ‚¨çš„æé—®ï¼š"${userMessage}"ã€‚è®©æˆ‘æ¥åˆ†æä¸€ä¸‹ã€‚`
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addMessage('assistant', randomResponse);
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const messageText = promptInput.value.trim();
            const images = [...appState.uploadedImages];
            
            if (!messageText && images.length === 0) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            if (messageText) {
                addMessage('user', messageText, images);
                appState.messages.push({ role: 'user', content: messageText, images });
            }

            // æ¸…ç©ºè¾“å…¥æ¡†å’Œå›¾ç‰‡
            promptInput.value = '';
            promptInput.style.height = 'auto';
            appState.uploadedImages = [];
            imagePreview.innerHTML = '';
            
            // ç¦ç”¨å‘é€æŒ‰é’®
            sendButton.disabled = true;
            appState.isProcessing = true;

            // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
            showTypingIndicator();

            try {
                // å¤„ç†è¯·æ±‚
                await handleHomeworkRequest(messageText, images);
            } catch (error) {
                hideTypingIndicator();
                addMessage('assistant', 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ã€‚è¯·ç¨åå†è¯•ã€‚');
                console.error('å‘é€æ¶ˆæ¯é”™è¯¯:', error);
            } finally {
                // å¯ç”¨å‘é€æŒ‰é’®
                sendButton.disabled = false;
                appState.isProcessing = false;
                promptInput.focus();
            }
        }

        // å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        sendButton.addEventListener('click', sendMessage);

        // å›è½¦é”®å‘é€ï¼ˆShift+Enter æ¢è¡Œï¼‰
        promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // æ–‡ä»¶ä¸Šä¼ 
        fileUploadBtn.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imageUrl = event.target.result;
                        appState.uploadedImages.push(imageUrl);
                        
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-preview-item';
                        imageItem.innerHTML = `
                            <img src="${imageUrl}" alt="é¢„è§ˆ">
                            <button class="remove-btn" onclick="this.parentElement.remove(); appState.uploadedImages = appState.uploadedImages.filter(img => img !== '${imageUrl}');">Ã—</button>
                        `;
                        imagePreview.appendChild(imageItem);
                    };
                    reader.readAsDataURL(file);
                }
            });
            fileInput.value = '';
        });

        // è¯­éŸ³è¾“å…¥ï¼ˆæ¨¡æ‹Ÿï¼‰
        voiceBtn.addEventListener('click', () => {
            if (appState.isRecording) {
                // åœæ­¢å½•éŸ³
                appState.isRecording = false;
                voiceBtn.style.background = 'white';
                alert('è¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼šæ¨¡æ‹Ÿåœæ­¢å½•éŸ³');
            } else {
                // å¼€å§‹å½•éŸ³
                appState.isRecording = true;
                voiceBtn.style.background = '#ff4d4f';
                alert('è¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼šæ¨¡æ‹Ÿå¼€å§‹å½•éŸ³ï¼Œè¯·è¯´è¯...');
            }
        });

        // æˆ‘çš„æŒ‰é’®
        myBtn.addEventListener('click', () => {
            alert('æˆ‘çš„ï¼šæŸ¥çœ‹ä¸ªäººä¿¡æ¯å’Œè®¾ç½®');
        });

        // æ–°å»ºä¼šè¯æŒ‰é’®
        newChatBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦æ–°å»ºä¼šè¯å—ï¼Ÿå½“å‰ä¼šè¯å°†è¢«æ¸…ç©ºã€‚')) {
                const currentFunction = appState.currentFunction;
                chatContent.innerHTML = '';
                appState.messages = [];
                appState.uploadedImages = [];
                imagePreview.innerHTML = '';
                appState.showConfig = false;
                chatContainer.style.display = 'flex';
                configPanel.classList.remove('active');
                
                // æ·»åŠ å½“å‰åŠŸèƒ½çš„æ¬¢è¿æ¶ˆæ¯
                const config = functionConfig[currentFunction] || functionConfig.homework;
                addMessage('assistant', config.welcomeMessage || 'æ‚¨å¥½ï¼æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ã€‚');
            }
        });

        // å†å²è®°å½•æŒ‰é’®
        historyBtn.addEventListener('click', () => {
            alert('å†å²è®°å½•åŠŸèƒ½ï¼šæŸ¥çœ‹å½“å‰åŠ©ç†çš„å†å²ä¼šè¯è®°å½•');
            // è¿™é‡Œå¯ä»¥æ‰“å¼€å†å²è®°å½•é¢æ¿æˆ–å¼¹çª—
        });

        // é¢„è§ˆæŒ‰é’®
        previewBtn.addEventListener('click', () => {
            alert('é¢„è§ˆåŠŸèƒ½ï¼šæŸ¥çœ‹ä½œä¸šé¢„è§ˆæ•ˆæœ');
        });

        // å–æ¶ˆæŒ‰é’®
        cancelBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦å–æ¶ˆæœ¬æ¬¡é…ç½®å—ï¼Ÿå°†è¿”å›èŠå¤©ç•Œé¢ã€‚')) {
                appState.showConfig = false;
                chatContainer.style.display = 'flex';
                configPanel.classList.remove('active');
                
                // æ·»åŠ æç¤ºæ¶ˆæ¯
                addMessage('assistant', 'å·²å–æ¶ˆæœ¬æ¬¡ä½œä¸šé…ç½®ï¼Œæ‚¨å¯ä»¥é‡æ–°æè¿°æ‚¨çš„éœ€æ±‚ã€‚');
            }
        });

        // å­˜å‚¨å·²å‘å¸ƒçš„ä½œä¸šé…ç½®
        let publishedHomeworkConfig = null;

        // å‘å¸ƒæŒ‰é’®
        publishBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦å‘å¸ƒè¿™ä»½ä½œä¸šå—ï¼Ÿ')) {
                // æ”¶é›†é…ç½®ä¿¡æ¯ - ä½¿ç”¨æ›´ç²¾ç¡®çš„é€‰æ‹©å™¨
                const form = document.querySelector('.config-form');
                const subjectInputs = form.querySelectorAll('.form-row .form-input');
                const subject = Array.from(subjectInputs).map(input => input.value).filter(Boolean).join(' - ');
                
                const configData = {
                    subject: subject || '',
                    version: Array.from(form.querySelectorAll('.form-group')).find(g => {
                        const label = g.querySelector('label');
                        return label && label.textContent.includes('ç‰ˆæœ¬åˆ†å†Œ');
                    })?.querySelector('.form-input')?.value || '',
                    catalog: document.getElementById('textbookCatalog')?.value || '',
                    knowledge: form.querySelector('textarea.form-textarea[readonly]')?.value || '',
                    questionTypes: Array.from(form.querySelectorAll('.checkbox-item input:checked')).map(cb => {
                        const label = cb.nextElementSibling;
                        return label?.textContent?.trim();
                    }).filter(Boolean),
                    count: Array.from(form.querySelectorAll('.form-group')).find(g => {
                        const label = g.querySelector('label');
                        return label && label.textContent.includes('æ•°é‡');
                    })?.querySelector('.form-input')?.value || '',
                    homeworkType: (() => {
                        const checked = form.querySelector('input[name="homeworkType"]:checked');
                        return checked?.nextElementSibling?.textContent?.trim() || '';
                    })(),
                    publishTarget: Array.from(form.querySelectorAll('.tag')).map(tag => tag.textContent?.trim()).filter(Boolean),
                    publishTime: Array.from(form.querySelectorAll('.form-group')).find(g => {
                        const label = g.querySelector('label');
                        return label && label.textContent.includes('å‘å¸ƒæ—¶é—´');
                    })?.querySelector('.form-input')?.value || '',
                    otherRequirements: form.querySelector('textarea.form-textarea:not([readonly])')?.value || ''
                };
                publishedHomeworkConfig = configData;

                // å‘å¸ƒæˆåŠŸåï¼Œè¿”å›èŠå¤©ç•Œé¢å¹¶æ˜¾ç¤ºæ¶ˆæ¯å’ŒæŸ¥çœ‹æŒ‰é’®
                appState.showConfig = false;
                chatContainer.style.display = 'flex';
                configPanel.classList.remove('active');
                
                // æ·»åŠ å‘å¸ƒæˆåŠŸçš„æ¶ˆæ¯ï¼ŒåŒ…å«æŸ¥çœ‹æŒ‰é’®
                const messageDiv = document.createElement('ai-message');
                messageDiv.setAttribute('role', 'assistant');
                const time = getRelativeTime();
                const messageHTML = `
                    <div class="message assistant">
                        <div class="message-avatar">AI</div>
                        <div>
                            <div class="message-content">
                                <div>ä½œä¸šå·²æˆåŠŸå‘å¸ƒï¼</div>
                                <button class="homework-view-btn" onclick="showHomeworkPreview()" style="
                                    margin-top: 12px;
                                    padding: 6px 16px;
                                    background: #1890ff;
                                    color: white;
                                    border: none;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    cursor: pointer;
                                    transition: all 0.2s;
                                    box-shadow: 0 2px 0 rgba(5, 145, 255, 0.1);
                                ">æŸ¥çœ‹ä½œä¸šè¯¦æƒ…</button>
                            </div>
                            <div class="message-time">${time}</div>
                        </div>
                    </div>
                `;
                messageDiv.innerHTML = messageHTML;
                chatContent.appendChild(messageDiv);
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                setTimeout(() => {
                    chatContent.scrollTop = chatContent.scrollHeight;
                }, 100);
            }
        });

        // ä½œä¸šé¢„è§ˆåŠŸèƒ½
        function showHomeworkPreview() {
            if (!publishedHomeworkConfig) {
                alert('æš‚æ— ä½œä¸šé…ç½®ä¿¡æ¯');
                return;
            }

            // åˆ›å»ºæ¨¡æ€æ¡†
            let modal = document.getElementById('homeworkPreviewModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'homeworkPreviewModal';
                modal.className = 'homework-preview-modal';
                modal.innerHTML = `
                    <div class="homework-preview-content">
                        <div class="homework-preview-header">
                            <h3>ä½œä¸šè¯¦æƒ…é¢„è§ˆ</h3>
                            <button class="homework-preview-close" onclick="closeHomeworkPreview()">Ã—</button>
                        </div>
                        <div class="homework-preview-body" id="homeworkPreviewBody">
                            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // ç‚¹å‡»é®ç½©å±‚å…³é—­
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeHomeworkPreview();
                    }
                });
            }

            // å¡«å……é¢„è§ˆå†…å®¹
            const body = document.getElementById('homeworkPreviewBody');
            const config = publishedHomeworkConfig;
            body.innerHTML = `
                <div class="preview-item">
                    <div class="preview-label">å­¦æ®µå­¦ç§‘</div>
                    <div class="preview-value">${config.subject}</div>
                </div>
                <div class="preview-item">
                    <div class="preview-label">ç‰ˆæœ¬åˆ†å†Œ</div>
                    <div class="preview-value">${config.version}</div>
                </div>
                ${config.catalog ? `
                <div class="preview-item">
                    <div class="preview-label">æ•™è¾…ç›®å½•</div>
                    <div class="preview-value">${config.catalog}</div>
                </div>
                ` : ''}
                <div class="preview-item">
                    <div class="preview-label">çŸ¥è¯†ç‚¹</div>
                    <div class="preview-value">${config.knowledge}</div>
                </div>
                <div class="preview-item">
                    <div class="preview-label">é¢˜å‹</div>
                    <div class="preview-tags">
                        ${config.questionTypes.map(type => `<span class="preview-tag">${type}</span>`).join('')}
                    </div>
                </div>
                <div class="preview-item">
                    <div class="preview-label">æ•°é‡</div>
                    <div class="preview-value">${config.count} é“(å«å°é¢˜)</div>
                </div>
                <div class="preview-item">
                    <div class="preview-label">ä½œä¸šç±»å‹</div>
                    <div class="preview-value">${config.homeworkType}</div>
                </div>
                <div class="preview-item">
                    <div class="preview-label">å‘å¸ƒå¯¹è±¡</div>
                    <div class="preview-tags">
                        ${config.publishTarget.map(target => `<span class="preview-tag">${target}</span>`).join('')}
                    </div>
                </div>
                <div class="preview-item">
                    <div class="preview-label">å‘å¸ƒæ—¶é—´</div>
                    <div class="preview-value">${config.publishTime}</div>
                </div>
                ${config.otherRequirements ? `
                <div class="preview-item">
                    <div class="preview-label">å…¶ä»–è¦æ±‚</div>
                    <div class="preview-value">${config.otherRequirements}</div>
                </div>
                ` : ''}
            `;

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.classList.add('active');
        }

        // å…³é—­ä½œä¸šé¢„è§ˆ
        function closeHomeworkPreview() {
            const modal = document.getElementById('homeworkPreviewModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä»¥ä¾¿HTMLä¸­çš„onclickå¯ä»¥ä½¿ç”¨
        window.showHomeworkPreview = showHomeworkPreview;
        window.closeHomeworkPreview = closeHomeworkPreview;

        // åˆå§‹åŒ– - æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        const initialConfig = functionConfig[appState.currentFunction] || functionConfig.homework;
        addMessage('assistant', initialConfig.welcomeMessage || 'æ‚¨å¥½ï¼æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ã€‚');
        promptInput.focus();
    </script>
</body>
</html>